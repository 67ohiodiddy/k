local ALLOWED_GAME_IDS = {
    [109983668079237] = true, -- Steal a Brainrot
    [96342491571673]  = true  -- Second supported place
}

local currentGameId = game.PlaceId

if not ALLOWED_GAME_IDS[currentGameId] then
    warn(string.format(
        "‚ùå WRONG GAME! Allowed IDs: %s | Got: %d",
        table.concat({109983668079237, 96342491571673}, ", "),
        currentGameId
    ))
    return
end

print("‚úÖ Game ID verified:", currentGameId)

local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local HttpService = game:GetService("HttpService")
local LocalPlayer = Players.LocalPlayer

local Config = {
    game_name = "Steal a Brainrot"
}

-- Function to determine account ID from player name
local function getAccountId()
    -- Try to extract account number if following naming convention
    -- Otherwise use player name
    local playerName = LocalPlayer.Name
    return "Account_1" -- Default, will be overridden by multiple instances
end

local function sendBrainrotsToDashboard(brainrots)
    pcall(function()
        request({
            Url = "http://127.0.0.1:6969/report_brainrot",
            Method = "POST",
            Headers = {["Content-Type"] = "application/json"},
            Body = HttpService:JSONEncode({
                account = LocalPlayer.Name,
                brainrots = brainrots,
                game = Config.game_name
            })
        })
    end)
end

local function sendKillSignal()
    pcall(function()
        request({
            Url = "http://127.0.0.1:6969/killprocess",
            Method = "POST",
            Headers = {["Content-Type"] = "application/json"},
            Body = HttpService:JSONEncode({
                account_id = getAccountId()
            })
        })
        print("üî¥ Kill signal sent to dashboard")
    end)
end

local function scanOnlyMyPlot()
    local myPlot = nil
    
    -- 1. Find your specific plot folder
    for _, plot in ipairs(Workspace.Plots:GetChildren()) do
        local sign = plot:FindFirstChild("PlotSign")
        if sign then
            local gui = sign:FindFirstChild("SurfaceGui")
            local label = gui and gui:FindFirstChild("Frame") and gui.Frame:FindFirstChild("TextLabel")
            if label and (label.Text:find(LocalPlayer.DisplayName) or label.Text:find(LocalPlayer.Name)) then
                myPlot = plot
                break
            end
        end
    end
    
    if not myPlot then
        warn("Could not identify your plot. Make sure your name is on the sign!")
        return
    end
    
    -- 2. Define strict boundaries
    local center = myPlot.PlotSign.Position
    local range = 50
    
    print("------------------------------------------")
    print("üéÆ Game: " .. Config.game_name)
    print("üìç SCANNING ONLY YOUR PLOT: " .. myPlot.Name)
    print("------------------------------------------")
    
    local debris = Workspace:FindFirstChild("Debris")
    local found = 0
    local seen = {}
    local brainrotList = {}
    
    if debris then
        for _, temp in ipairs(debris:GetChildren()) do
            if temp.Name == "FastOverheadTemplate" then
                local pos = temp.Position
                local dist = Vector2.new(pos.X - center.X, pos.Z - center.Z).Magnitude
                
                if dist < range then
                    local oh = temp:FindFirstChild("AnimalOverhead")
                    if oh then
                        local nameLbl = oh:FindFirstChild("DisplayName")
                        local genLbl = oh:FindFirstChild("Generation")
                        
                        if nameLbl and genLbl then
                            local entry = nameLbl.Text .. genLbl.Text
                            if not seen[entry] then
                                seen[entry] = true
                                found = found + 1
                                
                                -- Add to brainrot list for dashboard
                                table.insert(brainrotList, {
                                    name = nameLbl.Text,
                                    generation = genLbl.Text
                                })
                                
                                print(string.format("[%d] %s | %s", found, nameLbl.Text, genLbl.Text))
                            end
                        end
                    end
                end
            end
        end
    end
    
    if found == 0 then
        print("No brainrots detected inside your plot boundaries.")
    else
        -- Send brainrots to dashboard
        sendBrainrotsToDashboard(brainrotList)
        print(string.format("üìä Sent %d brainrots to dashboard", found))
    end
    
    print("------------------------------------------")
    
    -- Wait a moment for the data to send, then kill the process
    wait(1)
    sendKillSignal()
    wait(0.5)
end

scanOnlyMyPlot()
